<!doctype html><html lang=en><head><title>Lima quick-start · Pragmatic Programming</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Paweł Weselak"><meta name=description content="When you need Docker Desktop alternative"><meta name=keywords content="Paweł Weselak,personal blog,senior java developer,senior software engineer"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lima quick-start"><meta name=twitter:description content="When you need Docker Desktop alternative"><meta property="og:title" content="Lima quick-start"><meta property="og:description" content="When you need Docker Desktop alternative"><meta property="og:type" content="article"><meta property="og:url" content="https://pawelweselak.com/posts/lima-vm/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-22T21:50:30+02:00"><meta property="article:modified_time" content="2023-12-30T19:22:36+01:00"><link rel=canonical href=https://pawelweselak.com/posts/lima-vm/><link rel=preload href="https://pawelweselak.com/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://pawelweselak.com/css/coder.min.135e22c97ff685fe983fc60048e309ced8f00d8d38f536aa67dba8a13a03dfa4.css integrity="sha256-E14iyX/2hf6YP8YASOMJztjwDY049TaqZ9uooToD36Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://pawelweselak.com/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=https://pawelweselak.com/images/favicon.svg sizes=any><link rel=icon type=image/png href=https://pawelweselak.com/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://pawelweselak.com/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://pawelweselak.com/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://pawelweselak.com/images/apple-touch-icon.png><link rel=manifest href=https://pawelweselak.com/site.webmanifest><link rel=mask-icon href=https://pawelweselak.com/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://pawelweselak.com/>Pragmatic Programming</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/categories/>Categories</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/tags/>Tags</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://pawelweselak.com/posts/lima-vm/>Lima quick-start</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-08-22T21:50:30+02:00>August 22, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=https://pawelweselak.com/categories/devops/>devops</a>
<span class=separator>•</span>
<a href=https://pawelweselak.com/categories/tools/>tools</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://pawelweselak.com/tags/lima/>lima</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/docker/>docker</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/networking/>networking</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/dns/>dns</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/containerisation/>containerisation</a></span></div></div></header><div class=post-content><h2 id=motivation>Motivation
<a class=heading-link href=#motivation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Since January 31st, 2022 Docker Desktop cannot be commercially used for free in bigger organisations.
Until now several tools may fill the gap, if you, my Dear Developer, forced to uninstall Docker Desktop.
Docker Desktop is a complete, self-sufficient package ready to use tools including UI to run containers.
To replace Docker Desktop you will need to build a custom setup comprising set of tools.
Installing and configuring different tools may be complex and time-consuming.
On the other hand, you have more control and flexibility.</p><p>In this article I will describe simplistic approach to run Lima-VM on macOS combined with standard Docker CLI,
which is still free to use for everyone.
I will cover also configuration changes I applied to make Lima working for me. I would like to emphasize
network setup for DNS and cross-arch support for new Apple Silicon M1 processors.</p><h2 id=what-is-lima>What is Lima?
<a class=heading-link href=#what-is-lima><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Lima stands for &ldquo;Linux machines&rdquo;. It was created to run Linux virtual machines as guests on macOS hosts.
Although, Lima can be used on Linux hosts as well.</p><p>It is built on top QEMU, quick emulator.
It makes possible running multiple operating systems on the same physical machine.</p><h2 id=installing-lima-and-starting-vm>Installing Lima and Starting VM
<a class=heading-link href=#installing-lima-and-starting-vm><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To install Lima on macOS it is enough to handover it to brew.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install lima
</span></span></code></pre></div><p>Another way is to install Lima from sources, but in 99% cases you don&rsquo;t gonna need it.
I do not cover installation from sources in this article.</p><p>After installation, you may want to check the version of Lima.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lima --version
</span></span></code></pre></div><p>Now it is time to start first Virtual Machine with Lima.
There are preconfigured templates (configurations) you can use out of the box.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>limactl start template://docker
</span></span></code></pre></div><p>Here <code>docker</code> is a template name.</p><p>To check available templates, run</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>limactl start --list-templates
</span></span></code></pre></div><p>You can prepare your own configuration in local yaml file or tweak existing examples.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /usr/local/share/doc/lima/examples/docker.yaml .
</span></span><span class=line><span class=cl><span class=c1># do some changes in docker.yaml here</span>
</span></span><span class=line><span class=cl>limactl start ./docker.yaml
</span></span></code></pre></div><p>You can also start lima passing <code>name</code> parameter.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>limactl start --name<span class=o>=</span>default template://docker
</span></span></code></pre></div><p>By default, the name of the VM instance is the same as template name or name of local file without <code>.yaml</code> extensions.</p><p>To stop and delete instance, refer to its name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>limactl stop docker
</span></span><span class=line><span class=cl>limactl delete docker
</span></span></code></pre></div><p>If the instance name is <code>default</code> you can omit name in the command.
Or you can set <code>LIMA_INSTANCE</code> env variable and <code>limactl</code> commands will refer to instance name defined in the variable.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LIMA_INSTANCE</span><span class=o>=</span><span class=s2>&#34;docker&#34;</span>
</span></span></code></pre></div><h2 id=configuration>Configuration
<a class=heading-link href=#configuration><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I won&rsquo;t cover all possible config options here. Rather than that I will describe two aspects which I had to change,
to make Lima usable on my end.</p><p>After creating VM, a folder is created under <code>~/.lima</code> named the same as VM.
You can find <code>lima.yaml</code> there, your VM configuration file.</p><h3 id=cross-arch>Cross-arch
<a class=heading-link href=#cross-arch><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>You may have new, shiny mac with Apple Silicon M1 microchip.
Despite the fact, it may be a good idea to switch back to x86 64-bit architecture.
It will save you troubles with running containers not available for new Apple architecture.</p><p>Just put one line in your <code>lima.yaml</code> and restart a machine.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>arch</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;x86_64&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=network>Network
<a class=heading-link href=#network><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>By default, guest OS works in so called user-mode network, and generally it has limitations.
There are many issues regarding network support in Lima&rsquo;s GitHub. Not all of them are already closed.</p><p>Personally, I had a problem with domain names resolution. I am connected to corporate network. Most often I use VPN.
In my case DNS hosts were incorrectly passed from host to guest OS.</p><p>Fortunately, there is a way to enforce DNS IPs in guest. I had to add following config to <code>lima.yaml</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=m>10.</span><span class=l>a.b.c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=m>10.</span><span class=l>x.y.z</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=m>1.1.1.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=m>1.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>useHostResolver</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span></code></pre></div><p>First two addresses indicate corporate/VPN network DNS hosts. Next pair is primary and secondary servers of Cloudflare.
They can be replaced by any other publicly accessible DNS servers.
They are used as a fallback when you outside corporate/VPN network.</p><p>Don&rsquo;t forget to change <code>useHostResolver</code> to false. Otherwise, VM won&rsquo;t start.</p><h2 id=running-a-container>Running a container
<a class=heading-link href=#running-a-container><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Install docker CLI if not done already.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install docker docker-compose docker-credential-helper
</span></span></code></pre></div><p>The last one is a tool to use mac keychain for storing container registry passwords after doing <code>docker login ...</code>.</p><p>After starting Lima VM from docker template, message is printed with info how to run a container with docker CLI.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker context create lima-docker --docker <span class=s2>&#34;host=unix://&lt;DIRECTORY&gt;/sock/docker.sock&#34;</span>
</span></span><span class=line><span class=cl>docker context use lima-docker
</span></span><span class=line><span class=cl>docker run hello-world
</span></span></code></pre></div><h2 id=next-steps>Next steps
<a class=heading-link href=#next-steps><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To unlock full potential of Lima, you probably what to use it with Containerd.
Containerd has certain advanced features when comes to running containers.
Moreover, if you&rsquo;re working in cross-arch environment,
having Containerd enabled is more performant than solution presented in the article.</p><h2 id=sources>Sources
<a class=heading-link href=#sources><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li><a href=https://github.com/lima-vm class=external-link target=_blank rel=noopener>https://github.com/lima-vm</a></li><li><a href=https://www.qemu.org/ class=external-link target=_blank rel=noopener>https://www.qemu.org/</a></li><li><a href=https://wiki.qemu.org/Documentation/Networking class=external-link target=_blank rel=noopener>https://wiki.qemu.org/Documentation/Networking</a></li></ul></div><footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//pragmatic-programming.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}(),document.addEventListener("themeChanged",function(){document.readyState=="complete"&&DISQUS.reset({reload:!0,config:disqus_config})})</script></footer></article></section></div><footer class=footer><section class=container>©
2010 -
2025
Paweł Weselak
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.
[<a href=https://github.com/frenchu/pragmatic-programming/tree/64f89d4447f27320fe099cea9e13457d20eb2c6b target=_blank rel=noopener>64f89d4</a>]</section></footer></main><script src=https://pawelweselak.com/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>