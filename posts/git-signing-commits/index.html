<!doctype html><html lang=en><head><title>Make your commits more reliable and secure · Pragmatic Programming</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Paweł Weselak"><meta name=description content="Setting up commit signatures"><meta name=keywords content="Paweł Weselak,personal blog,senior java developer,senior software engineer"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pawelweselak.com/images/signature.jpg"><meta name=twitter:title content="Make your commits more reliable and secure"><meta name=twitter:description content="Setting up commit signatures"><meta property="og:title" content="Make your commits more reliable and secure"><meta property="og:description" content="Setting up commit signatures"><meta property="og:type" content="article"><meta property="og:url" content="https://pawelweselak.com/posts/git-signing-commits/"><meta property="og:image" content="https://pawelweselak.com/images/signature.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-21T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-10T21:00:49+02:00"><meta property="og:see_also" content="https://pawelweselak.com/posts/github-multiuser/"><meta property="og:see_also" content="https://pawelweselak.com/posts/git-cheatsheet/"><link rel=canonical href=https://pawelweselak.com/posts/git-signing-commits/><link rel=preload href="https://pawelweselak.com/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://pawelweselak.com/css/coder.min.135e22c97ff685fe983fc60048e309ced8f00d8d38f536aa67dba8a13a03dfa4.css integrity="sha256-E14iyX/2hf6YP8YASOMJztjwDY049TaqZ9uooToD36Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://pawelweselak.com/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=https://pawelweselak.com/images/favicon.svg sizes=any><link rel=icon type=image/png href=https://pawelweselak.com/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://pawelweselak.com/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://pawelweselak.com/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://pawelweselak.com/images/apple-touch-icon.png><link rel=manifest href=https://pawelweselak.com/site.webmanifest><link rel=mask-icon href=https://pawelweselak.com/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://pawelweselak.com/>Pragmatic Programming</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/categories/>Categories</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/tags/>Tags</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://pawelweselak.com/posts/git-signing-commits/>Make your commits more reliable and secure</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2024-02-21T00:00:00Z>February 21, 2024</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=https://pawelweselak.com/categories/tools/>tools</a>
<span class=separator>•</span>
<a href=https://pawelweselak.com/categories/security/>security</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://pawelweselak.com/tags/git/>git</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/github/>github</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/ssh/>ssh</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/digital-signatures/>digital signatures</a></span></div></div></header><div class=post-content><p>Most probably you are aware of SSH private key authentication mechanism. Recent developments in OpenSSH tooling
enable using SSH private keys also for signing.
There is a debate if it is right decision to add a new capibility to OpenSSH which was designed for other purpose.
Let&rsquo;s leave aside this dispute and just check how we can benefit from SSH signing functionality.</p><p>On a daily basis I use SSH for interactions with git repositories. Both GitHub and GitLab allows to configure SSH keys for
authentication. Moreover, both of them allow set your SSH keys for signing commits. Having your commit signed,
every third party may use your SSH public key to confirm that you are actually the commit author.
You can easily prove your commit atribution. And other way around, imposters will have a hard nut to crack if they
decide to spoof your work.</p><p>In this tutorial I want to show how to prepare your environment for commit signing and don&rsquo;t get a headache somewhere between.</p><figure><img src=https://pawelweselak.com/images/signature.jpg alt="Signature - desk with documents and inkwell"><figcaption><p>Commit signature</p></figcaption></figure><h2 id=upload-signing-key-to-githubgitlab>Upload signing key to GitHub/GitLab
<a class=heading-link href=#upload-signing-key-to-githubgitlab><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Go to your user profile on GitHub or GitLab, whichever you prefer, find SSH/PGP keys page and upload your SSH public key under &lsquo;signing&rsquo; section.
I believe in most of the git hosting services it looks quite similar. If you are using multiple keys, you can add a name to distinguish them.</p><p>Remember to keep your private key safe at all times! Don&rsquo;t copy or move your private key between machines.
Better off generate another key for a new device. Remove key from GitHub as soon as it is no longer needed or you lost control over it.</p><p>Personally, I use the same key for signing and authentication. Perhabs it should be separated.
Please let me know what you think in the comments section below. ;)</p><h2 id=configuring-git-in-your-local>Configuring git in your local
<a class=heading-link href=#configuring-git-in-your-local><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>When a remote server is aware of your public keys, it&rsquo;s time to configure git locally.</p><p>Let&rsquo;s start with setting signing key format to SSH</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git config --global gpg.format ssh
</span></span></code></pre></div><p>Now tell git about your signing key (it can be public if you are using ssh-agent)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git config --global user.signingKey ~/.ssh/id_ed25519.pub
</span></span></code></pre></div><p>Instead of path to a file, you can provide the public key directly in the command line. It needs to be prefixed with <code>key::</code>.</p><p>Alternatively, you may want to return your key contents in more dynamic way (e.g. via shell script)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git config --global gpg.ssh.defaultKeyCommand ~/bin/key_provider.sh
</span></span></code></pre></div><p>If you have SSH agent set up, <code>ssh-add -L</code> can be very convinient here</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git config --global gpg.ssh.defaultKeyCommand <span class=s2>&#34;ssh-add -L&#34;</span>
</span></span></code></pre></div><p>Now you can go to one of your repos and commit anything with your signature</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git commit -S -m <span class=s2>&#34;New post&#34;</span>
</span></span></code></pre></div><p>You can sign all new commits and tags by default and don&rsquo;t have to put &lsquo;-S&rsquo; option each time</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git config --global commit.gpgsign <span class=nb>true</span>
</span></span><span class=line><span class=cl>git config --global tag.gpgsign <span class=nb>true</span>
</span></span></code></pre></div><h2 id=verifying-signed-commits>Verifying signed commits
<a class=heading-link href=#verifying-signed-commits><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To check signature of any given commit do</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git verify-commit &lt;commit_sha&gt;
</span></span></code></pre></div><p>For example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git verify-commit HEAD
</span></span></code></pre></div><p>Or look into the history which commits are signed</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git log --show-signature
</span></span></code></pre></div><p>You probably will see error messages saying that git is unable to prove commits authenticity. It&rsquo;s because we need to inform git
what keys are allowed to sign commits. In <code>allowed_signers</code> file put public keys of the authors who embrace commit signatures,
including yourself ofcourse.</p><p>This is how to inculde yourself to &ldquo;allowed signers&rdquo; gang</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git config --global gpg.ssh.allowedSignersFile ~/.ssh/allowed_signers
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=k>$(</span>git config --get user.email<span class=k>)</span><span class=s2> namespaces=\&#34;git\&#34; </span><span class=k>$(</span>cat ~/.ssh/id_ed25519.pub<span class=k>)</span><span class=s2>&#34;</span> &gt;&gt; ~/.ssh/allowed_signers
</span></span></code></pre></div><p>GitHub gives convinient access to your public keys under the link</p><p><a href=https://github.com/frenchu.keys class=external-link target=_blank rel=noopener>https://github.com/&lt;YOUR_GH_USERNAME>.keys</a></p><p>You can share it with your teammates to obtain keys for verification of your commits.</p><p>If you are using github web interface to merge pull requests, github also signs its commits. You can obtain github public key from the url</p><p><a href=https://github.com/web-flow.gpg class=external-link target=_blank rel=noopener>https://github.com/web-flow.gpg</a></p><p>It is not SSH key, though. GitHub signs commits with PGP key which is part of a different story.
Hopefully, I will cover the subject in another post. :)</p><h2 id=additional-resources>Additional resources
<a class=heading-link href=#additional-resources><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li><a href=https://docs.github.com/en/authentication/managing-commit-signature-verification class=external-link target=_blank rel=noopener>https://docs.github.com/en/authentication/managing-commit-signature-verification</a></li><li><a href=https://docs.gitlab.com/ee/user/project/repository/signed_commits/ssh.html class=external-link target=_blank rel=noopener>https://docs.gitlab.com/ee/user/project/repository/signed_commits/ssh.html</a></li></ul></div><footer><section class=see-also><h3 id=see-also-in-git>See also in git
<a class=heading-link href=#see-also-in-git><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><nav><ul><li><a href=https://pawelweselak.com/posts/github-multiuser/>Multiple SSH keys setup for git</a></li><li><a href=https://pawelweselak.com/posts/git-cheatsheet/>Git cheatsheet</a></li></ul></nav></section><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//pragmatic-programming.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}(),document.addEventListener("themeChanged",function(){document.readyState=="complete"&&DISQUS.reset({reload:!0,config:disqus_config})})</script></footer></article></section></div><footer class=footer><section class=container>©
2010 -
2024
Paweł Weselak
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.
[<a href=https://github.com/frenchu/pragmatic-programming/tree/255c308508c6c1efed84529a06ff25cdbc0a3fb8 target=_blank rel=noopener>255c308</a>]</section></footer></main><script src=https://pawelweselak.com/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>