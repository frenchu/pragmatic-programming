<!doctype html><html lang=en><head><title>Multiple SSH keys setup for git · Pragmatic Programming</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Paweł Weselak"><meta name=description content="Using two GitHub accounts on the same workstation efectively"><meta name=keywords content="Paweł Weselak,personal blog,senior java developer,senior software engineer"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pawelweselak.com/images/git.jpg"><meta name=twitter:title content="Multiple SSH keys setup for git"><meta name=twitter:description content="Using two GitHub accounts on the same workstation efectively"><meta property="og:title" content="Multiple SSH keys setup for git"><meta property="og:description" content="Using two GitHub accounts on the same workstation efectively"><meta property="og:type" content="article"><meta property="og:url" content="https://pawelweselak.com/posts/github-multiuser/"><meta property="og:image" content="https://pawelweselak.com/images/git.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-27T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-21T21:20:59+01:00"><meta property="og:see_also" content="https://pawelweselak.com/posts/git-signing-commits/"><meta property="og:see_also" content="https://pawelweselak.com/posts/git-cheatsheet/"><link rel=canonical href=https://pawelweselak.com/posts/github-multiuser/><link rel=preload href="https://pawelweselak.com/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://pawelweselak.com/css/coder.min.135e22c97ff685fe983fc60048e309ced8f00d8d38f536aa67dba8a13a03dfa4.css integrity="sha256-E14iyX/2hf6YP8YASOMJztjwDY049TaqZ9uooToD36Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://pawelweselak.com/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=https://pawelweselak.com/images/favicon.svg sizes=any><link rel=icon type=image/png href=https://pawelweselak.com/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://pawelweselak.com/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://pawelweselak.com/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://pawelweselak.com/images/apple-touch-icon.png><link rel=manifest href=https://pawelweselak.com/site.webmanifest><link rel=mask-icon href=https://pawelweselak.com/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://pawelweselak.com/>Pragmatic Programming</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/categories/>Categories</a></li><li class=navigation-item><a class=navigation-link href=https://pawelweselak.com/tags/>Tags</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://pawelweselak.com/posts/github-multiuser/>Multiple SSH keys setup for git</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-12-22T00:00:00Z>December 22, 2023</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
5-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=https://pawelweselak.com/categories/tools/>tools</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://pawelweselak.com/tags/git/>git</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/github/>github</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://pawelweselak.com/tags/ssh/>ssh</a></span></div></div></header><div class=post-content><p>I always configure git to use SSH for connection. And I don&rsquo;t share private keys among instances. I belive this is the best practice.</p><p>As a contractor, I need to perform my work duties on my personal equipment from time to time.
Organisations quite often hosts its repositories on <a href=https://github.com/ class=external-link target=_blank rel=noopener>github.com</a>.</p><p>GitHub in its <a href=https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-your-personal-account/merging-multiple-personal-accounts class=external-link target=_blank rel=noopener>official docs</a> encourage users to use the same personal account for both private use and when working for an organisation.
However, quite often I want or even have to seperate work account and private one from each other.</p><p>The thing is I can&rsquo;t upload the same key for two different user accounts in GitHub.
It makes sense because GitHub identifies a user by SSH key, so the keys has to be unique.
It is also true for other similar services like BitBucket.</p><p>I have to generate two keys on my personal workstation in this case - one for work account and another for private account.
It causing some difficulties while working with git. I need to tell git somehow which key I want to use at the moment.</p><p>Below I described how to configure git to juggle SSH keys with an ease.</p><figure><img src=https://pawelweselak.com/images/git.jpg alt="Git - files of office paper"><figcaption><p>Git repository</p></figcaption></figure><h2 id=inline-git-command-configuration>Inline git command configuration
<a class=heading-link href=#inline-git-command-configuration><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The simplest way is to inline a configuration parameter when executing git command.
The parameter can change default command for SSH to pass custom key file path.</p><p>You can use environment variable</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>GIT_SSH_COMMAND</span><span class=o>=</span><span class=s2>&#34;ssh -i /path/to/key&#34;</span> git pull
</span></span></code></pre></div><p>or command line parameter</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git -c core.sshCommand<span class=o>=</span><span class=s2>&#34;ssh -i /path/to/key&#34;</span> git pull
</span></span></code></pre></div><p>If you want to switch from &lsquo;home&rsquo; mode to &lsquo;work&rsquo; mode for the whole terminal session,
you can export the varibale</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GIT_SSH_COMMAND</span><span class=o>=</span><span class=s2>&#34;ssh -i /path/to/key&#34;</span>
</span></span></code></pre></div><p>and the other key will be used with subsequent github commands.</p><p>Or you can set up a bash alias, something like</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>alias</span> gitw <span class=s1>&#39;git -c core.sshCommand=&#34;ssh -i /path/to/key&#34;&#39;</span>
</span></span></code></pre></div><p>and then do for example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>gitw pull
</span></span></code></pre></div><h2 id=includeif-directive-with-gitdir>IncludeIf directive with gitdir
<a class=heading-link href=#includeif-directive-with-gitdir><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>This setup is more complex, but on the other hand you don&rsquo;t need to set any variable each time you need to switch or remember to use alias.</p><p>If you have a clean separation between work and private projects on the directory structure level, you can go with this setup.</p><p>First edit your <code>~/.gitconfig</code> file to add <code>includeIf</code> directive:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[user]
</span></span><span class=line><span class=cl>    name = &#34;Pawel Weselak&#34;
</span></span><span class=line><span class=cl>    email = priv@pawelweselak.com
</span></span><span class=line><span class=cl>[includeIf &#34;gitdir:~/devel/work/&#34;]
</span></span><span class=line><span class=cl>    path = ~/devel/work/.gitconfig
</span></span></code></pre></div><p>This will tell git to use additional configuration for repos stored in <code>~/devel/work/</code> directory.</p><p>It will take additional config from <code>~/devel/work/.gitconfig</code>.
The path of the included config file can be freely changed.
If you use relative path, it will be relative to the location of <code>.gitconfig</code>.</p><p>In the included file change SSH command and let&rsquo;s say email:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[core]
</span></span><span class=line><span class=cl>    sshCommand = &#34;ssh -i /path/to/key&#34;
</span></span><span class=line><span class=cl>[user]
</span></span><span class=line><span class=cl>    email = pawel.weselak@example.com
</span></span></code></pre></div><p>To verify how new setup works execute command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git config --show-origin --get user.email
</span></span></code></pre></div><p>It should provide different outputs depending on the location of the repo inside or outside <code>~/devel/work/</code> directory.</p><p>The problem with this configuration is that it won&rsquo;t work when you want to clone a new repository.
It&rsquo;s because directories under <code>~/devel/work/</code> or the directory itself have to be an existing git repositories.</p><p>You can do <code>git init</code> under <code>~/devel/work/</code> to create a dummy repo, but it would be rather artificial and hacky.</p><p>Execute test commands below, to have a better understanding of the problem.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; cd
</span></span><span class=line><span class=cl>&gt; git config --show-origin --get user.email
</span></span><span class=line><span class=cl>file:/home/pweselak/.gitconfig priv@pawelweselak.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; cd ~/devel/work/
</span></span><span class=line><span class=cl>&gt; git config --show-origin --get user.email
</span></span><span class=line><span class=cl>file:/home/pweselak/.gitconfig priv@pawelweselak.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; mkdir test_repo &amp;&amp; cd test_repo
</span></span><span class=line><span class=cl>&gt; git config --show-origin --get user.email
</span></span><span class=line><span class=cl>file:/home/pweselak/.gitconfig priv@pawelweselak.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; git init
</span></span><span class=line><span class=cl>&gt; git config --show-origin --get user.email
</span></span><span class=line><span class=cl>file:/home/pweselak/devel/work/.gitconfig pawel.weselak@example.com
</span></span></code></pre></div><p>You can see that only after repo initialisation a new config has been applied.
Executing <code>git config</code> with <code>--show-origin</code> provides an information where the config comes from.</p><h2 id=includeif-directive-with-hasconfig>IncludeIf directive with hasconfig
<a class=heading-link href=#includeif-directive-with-hasconfig><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>After digging in git documentation and doing some tests, I&rsquo;ve found the way how to overcome difficulty described above.</p><p>We can use <code>hasconfig:remote</code> in <code>includeIf</code> directive. Take a look on my <code>~/.gitconfig</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[user]
</span></span><span class=line><span class=cl>    name = &#34;Pawel Weselak&#34;
</span></span><span class=line><span class=cl>    email = priv@pawelweselak.com
</span></span><span class=line><span class=cl>[includeIf &#34;hasconfig:remote.*.url:git@github.com:WorkOrg/**&#34;]
</span></span><span class=line><span class=cl>    path = ~/devel/work/.gitconfig
</span></span></code></pre></div><p>Contents of <code>~/devel/work/.gitconfig</code> remains the same.</p><p>Now all repos cloned from <code>WorkOrg</code> account/organisation on GitHub will use different configuration.
The best thing is when git clones the repo, it initialises the repo config with remote url and
only then the custom configuration is applied. So when the repo is fetched the right ssh key is used.
Thanks to that the <code>git clone</code> works smoothly.</p><p>In addition to that, you don&rsquo;t need to keep your directory structure neat and tidy.
The glob pattern in the remote url can be customized and more complex.</p><p>You can execute test commands, to check how git behaves now.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; git clone git@github.com:frenchu/hello-world.git
</span></span><span class=line><span class=cl>&gt; cd sample-repo
</span></span><span class=line><span class=cl>&gt; git config --show-origin --get user.email
</span></span><span class=line><span class=cl>file:/home/pweselak/.gitconfig priv@pawelweselak.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; cd ..
</span></span><span class=line><span class=cl>&gt; git clone git@github.com:WorkOrg/sample-repo.git
</span></span><span class=line><span class=cl>&gt; cd sample-repo
</span></span><span class=line><span class=cl>&gt; git config --show-origin --get user.email
</span></span><span class=line><span class=cl>file:/home/pweselak/devel/work/.gitconfig pawel.weselak@example.com
</span></span></code></pre></div><p>One caveat of <code>hasconfig</code> is that you need to have quite recent version of git installed - 2.36.0 or above.</p><h2 id=final-conclusions>Final conclusions
<a class=heading-link href=#final-conclusions><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Presented three methods of configuring git may be useful also in other scenarios.
You can not only apply different SSH keys, but also for instance sign commits with separate PGP signatures.</p><p>One noteworthy remark before the end. The order of reading config values from files is important.
Values read later will overwrite previous ones. Please bear in mind to keep <code>includeIf</code> directive at the end of the git config file.
Otherwise config set in included file may not be applied.</p><p>Leave your ideas in the comments section below.</p><p>Happy hacking!</p><h2 id=web-resources>Web resources
<a class=heading-link href=#web-resources><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li><a href=https://git-scm.com/docs/git-config#_conditional_includes class=external-link target=_blank rel=noopener>Conditional includes, Git documentation</a></li><li><a href=https://gist.github.com/jexchan/2351996 class=external-link target=_blank rel=noopener>Multiple SSH Keys settings for different github account Gist</a></li></ul></div><footer><section class=see-also><h3 id=see-also-in-git>See also in git
<a class=heading-link href=#see-also-in-git><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><nav><ul><li><a href=https://pawelweselak.com/posts/git-signing-commits/>Make your commits more reliable and secure</a></li><li><a href=https://pawelweselak.com/posts/git-cheatsheet/>Git cheatsheet</a></li></ul></nav></section><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//pragmatic-programming.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}(),document.addEventListener("themeChanged",function(){document.readyState=="complete"&&DISQUS.reset({reload:!0,config:disqus_config})})</script></footer></article></section></div><footer class=footer><section class=container>©
2010 -
2024
Paweł Weselak
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.
[<a href=https://github.com/frenchu/pragmatic-programming/tree/3ca37ad7e675974017f673a845a17dca557c1337 target=_blank rel=noopener>3ca37ad</a>]</section></footer></main><script src=https://pawelweselak.com/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>